<?php

function designssquare_com_site_loam_menu_install(){
    $t = get_t();

   // clear menus and create new ones
    foreach(_loam_menus_altered() as $menu){
        //remove menu links for clean install
        menu_delete_links($menu);
        drupal_set_message($t('Links deleted from menu - ' . $menu['menu_name']));

       if(!menu_load($menu['menu_name'])){
           //doesn't exist...lets create one
           drupal_set_message($t('Missing menu '.$menu['menu_name'].'...creating'));
           menu_save($menu);
       }
    }

    //map containing the structure of the menu
    $alias_map = array();

    //shuffle so that parents are always above the children menu items
    //this is important so when building the $alias_map child is not being inserted without parent already present
    $all_items = _loam_menu_installed_items();
    $parents_p1 = array();
    $parents_p2 = array();
    $parents_p3 = array();
    $parents_p4 = array();
    $parents_p5 = array();

    foreach($all_items as $key => $item){
        if($key == $item['p1']){
            $parents_p1[$key] = $item;
        }
        if($key == $item['p2']){
            $parents_p2[$key] = $item;
        }
        if($key == $item['p3']){
            $parents_p3[$key] = $item;
        }
        if($key == $item['p4']){
            $parents_p4[$key] = $item;
        }
        if($key == $item['p5']){
            $parents_p5[$key] = $item;
        }
    }

    $sorted_menu_list = array_merge($parents_p1,$parents_p2,$parents_p3,$parents_p4,$parents_p5);

    //add links
    foreach ($sorted_menu_list as $key => $item) {
        $alias_link_path = $item['link_path'];
        //look up node based on the alias path of existing drupal instance
        $item['link_path'] = drupal_get_normal_path($alias_link_path);

        //drupal_set_message('plid: '.$item['plid']. ' alias_map:' . $alias_map[$item['plid']] );
        $item['plid'] = ($item['plid'] !== 0 && !empty($alias_map[$item['plid']])) ? $alias_map[$item['plid']] : $item['plid'] ;
        $item['p1'] = ($item['p1'] !== 0 && !empty($alias_map[$item['p1']])) ? $alias_map[$item['p1']] : $item['p1'] ;
        $item['p2'] = ($item['p2'] !== 0 && !empty($alias_map[$item['p2']]) ) ? $alias_map[$item['p2']] : $item['p2'] ;
        $item['p3'] = ($item['p3'] !== 0 && !empty($alias_map[$item['p3']])) ? $alias_map[$item['p3']] : $item['p3'] ;

        $installed = menu_link_save($item);
        if($installed !== FALSE) {
            drupal_set_message($t('Menu Item : '. $key . ' installed'));
            //drupal_set_message('INSERT: link_path: '.$alias_link_path. ' mlip:' . $installed );
            $alias_map[$alias_link_path] = $installed;
        }else{
            drupal_set_message($t('Menu Item : '. $key . ' was not installed'));
        }
    }
    menu_link_save($item);
    menu_cache_clear_all();
    drupal_set_message($t('Installed Menu'));
}

function _loam_menus_altered(){
    return array (
        array(   'menu_name' => 'main-menu',   'title' => 'Main menu',   'description' => 'The <em>Main</em> menu is used on many sites to show the major sections of the site, often in a top navigation bar.'),
    );
}


function _loam_menu_installed_items() {
    return array (
        'sākums-latviesu-organizāciju-apvieniba-minesotā' => array(
            'menu_name' => 'main-menu',
            'plid' => '0',
            'link_path' => 'sākums-latviesu-organizāciju-apvieniba-minesotā',
            'link_title' => 'Sākums',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '-50',
            'depth' => '1',
            'customized' => '1',
            'p1' => 'sākums-latviesu-organizāciju-apvieniba-minesotā',
            'p2' => '0',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'latviešu-organizācijas-apvienība-minesotā-kalendārs/gads' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'link_path' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs/gads',
            'link_title' => 'Gads',
            'options' => array(
                'attributes' => array(
                    'title' => '',
                ),
            ),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '-50',
            'depth' => '2',
            'customized' => '1',
            'p1' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'p2' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs/gads',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'latviesu-organizāciju-apvieniba-minesotā' => array(
            'menu_name' => 'main-menu',
            'plid' => '0',
            'link_path' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_title' => 'LOAM',
            'options' => array(
                'attributes' => array(
                    'title' => '',
                ),
            ),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '1',
            'expanded' => '1',
            'weight' => '-49',
            'depth' => '1',
            'customized' => '1',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => '0',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'latviešu-organizācijas-apvienība-minesotā-kalendārs/mēnesis' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'link_path' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs/mēnesis',
            'link_title' => 'Mēnesis',
            'options' => array(
                'attributes' => array(
                    'title' => '',
                ),
            ),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '-49',
            'depth' => '2',
            'customized' => '1',
            'p1' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'p2' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs/mēnesis',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'latviešu-organizācijas-apvienība-minesotā-avīze' => array(
            'menu_name' => 'main-menu',
            'plid' => '0',
            'link_path' => 'latviešu-organizācijas-apvienība-minesotā-avīze',
            'link_title' => 'Avīze',
            'options' => array(
                'attributes' => array(),
            ),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '1',
            'weight' => '-48',
            'depth' => '1',
            'customized' => '1',
            'p1' => 'latviešu-organizācijas-apvienība-minesotā-avīze',
            'p2' => '0',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'latviešu-organizācijas-apvienība-minesotā-kalendārs/nedēļa' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'link_path' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs/nedēļa',
            'link_title' => 'Nedēļa',
            'options' => array(
                'attributes' => array(
                    'title' => '',
                ),
            ),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '-48',
            'depth' => '2',
            'customized' => '1',
            'p1' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'p2' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs/nedēļa',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'latviešu-organizācijas-apvienība-minesotā-kalendārs' => array(
            'menu_name' => 'main-menu',
            'plid' => '0',
            'link_path' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'link_title' => 'Kalendārs',
            'options' => array(
                'attributes' => array(
                    'title' => '',
                ),
            ),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '1',
            'expanded' => '1',
            'weight' => '-47',
            'depth' => '1',
            'customized' => '1',
            'p1' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'p2' => '0',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'latviešu-organizācijas-apvienība-minesotā-kalendārs/diena' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'link_path' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs/diena',
            'link_title' => 'Diena',
            'options' => array(
                'attributes' => array(
                    'title' => '',
                ),
            ),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '-47',
            'depth' => '2',
            'customized' => '1',
            'p1' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs',
            'p2' => 'latviešu-organizācijas-apvienība-minesotā-kalendārs/diena',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/kontakts' => array(
            'menu_name' => 'main-menu',
            'plid' => '0',
            'link_path' => 'content/kontakts',
            'link_title' => 'Kontakts',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '-46',
            'depth' => '1',
            'customized' => '1',
            'p1' => 'content/kontakts',
            'p2' => '0',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/teiksma' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/teiksma',
            'link_title' => 'Teiksma',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '2',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/teiksma',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/perkonītis' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/perkonītis',
            'link_title' => 'Perkonītis',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '2',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/perkonītis',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/selga' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/selga',
            'link_title' => 'SELGA',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '3',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/selga',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/tarts' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/tarts',
            'link_title' => 'TARTS',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '4',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/tarts',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/sp-latviešu-katoļu-draudze' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/sp-latviešu-katoļu-draudze',
            'link_title' => 'SP Latviešu katoļu draudze',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '6',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/sp-latviešu-katoļu-draudze',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/mspd-koris' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/mspd-koris',
            'link_title' => 'MSPD Koris',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '7',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/mspd-koris',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/mkgpf' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/mkgpf',
            'link_title' => 'MKGPF',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '8',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/mkgpf',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/msp-draudze' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/msp-draudze',
            'link_title' => 'MSP Draudze',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '9',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/msp-draudze',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/latviešu-skola' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/latviešu-skola',
            'link_title' => 'Latviešu Skola',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '9',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/latviešu-skola',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/lk-sabiedrība' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/lk-sabiedrība',
            'link_title' => 'LK Sabiedrība',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '10',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/lk-sabiedrība',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/latviešu-koncertapvienība-mn' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/latviešu-koncertapvienība-mn',
            'link_title' => 'Latviešu Koncertapvienība MN',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '11',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/latviešu-koncertapvienība-mn',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/kkm' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/kkm',
            'link_title' => 'KKM',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '12',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/kkm',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
        'content/kkm' => array(
            'menu_name' => 'main-menu',
            'plid' => 'latviesu-organizāciju-apvieniba-minesotā',
            'link_path' => 'content/kkm',
            'link_title' => 'KKM',
            'options' => array(),
            'module' => 'menu',
            'hidden' => '0',
            'external' => '0',
            'has_children' => '0',
            'expanded' => '0',
            'weight' => '12',
            'depth' => '2',
            'customized' => '0',
            'p1' => 'latviesu-organizāciju-apvieniba-minesotā',
            'p2' => 'content/kkm',
            'p3' => '0',
            'p4' => '0',
            'p5' => '0',
            'p6' => '0',
            'p7' => '0',
            'p8' => '0',
            'p9' => '0',
            'updated' => '0',
        ),
    );
}




